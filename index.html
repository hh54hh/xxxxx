<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ØµØ§Ù„Ø© Ø­Ø³Ø§Ù… Ø¬Ù… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙˆØ§Ù„ÙƒÙˆØ±Ø³Ø§Øª ÙˆØ§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©"
    />
    <meta name="keywords" content="ØµØ§Ù„Ø©, Ø¬Ù…, Ø¥Ø¯Ø§Ø±Ø©, Ù…Ø´ØªØ±ÙƒÙŠÙ†, ÙƒÙˆØ±Ø³Ø§Øª, ØºØ°Ø§Ø¡" />
    <meta name="author" content="ØµØ§Ù„Ø© Ø­Ø³Ø§Ù… Ø¬Ù…" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#16a34a" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="ØµØ§Ù„Ø© Ø­Ø³Ø§Ù… Ø¬Ù…" />

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/gym-icon-32.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/gym-icon-192.png"
    />
    <link rel="apple-touch-icon" href="/gym-icon-192.png" />

    <title>ØµØ§Ù„Ø© Ø­Ø³Ø§Ù… Ø¬Ù… - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
  </head>

  <body>
    <div id="root"></div>

    <script type="module" src="/src/main.tsx"></script>

    <!-- PWA Service Worker Registration -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js", {
              scope: "/",
            })
            .then((registration) => {
              console.log("SW registered: ", registration);

              // Handle service worker updates
              registration.addEventListener("updatefound", () => {
                const newWorker = registration.installing;
                if (newWorker) {
                  newWorker.addEventListener("statechange", () => {
                    if (
                      newWorker.state === "installed" &&
                      navigator.serviceWorker.controller
                    ) {
                      // New service worker available
                      if (
                        confirm(
                          "ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŸ",
                        )
                      ) {
                        newWorker.postMessage({ type: "SKIP_WAITING" });
                        window.location.reload();
                      }
                    }
                  });
                }
              });
            })
            .catch((registrationError) => {
              console.log("SW registration failed: ", registrationError);
            });

          // Handle service worker controller change
          navigator.serviceWorker.addEventListener("controllerchange", () => {
            window.location.reload();
          });
        });
      }

      // PWA Install prompt
      let deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;

        // Show install banner after 3 seconds
        setTimeout(() => {
          if (
            deferredPrompt &&
            !window.matchMedia("(display-mode: standalone)").matches
          ) {
            const installBanner = document.createElement("div");
            installBanner.innerHTML = `
              <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; background: #16a34a; color: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 9999; font-family: Cairo, sans-serif; text-align: center;">
                <div style="margin-bottom: 10px;">ðŸ“± Ù‚Ù… Ø¨ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ ØµØ§Ù„Ø© Ø­Ø³Ø§Ù… Ø¬Ù…</div>
                <button onclick="installApp()" style="background: white; color: #16a34a; border: none; padding: 8px 16px; border-radius: 5px; margin-left: 10px; cursor: pointer; font-weight: bold;">ØªØ«Ø¨ÙŠØª</button>
                <button onclick="dismissInstall()" style="background: transparent; color: white; border: 1px solid white; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Ù„Ø§Ø­Ù‚Ø§Ù‹</button>
              </div>
            `;
            document.body.appendChild(installBanner);
          }
        }, 3000);
      });

      function installApp() {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("User accepted the install prompt");
            }
            deferredPrompt = null;
            dismissInstall();
          });
        }
      }

      function dismissInstall() {
        const banner = document.querySelector('[style*="position: fixed"]');
        if (banner) banner.remove();
      }

      // Handle app install
      window.addEventListener("appinstalled", () => {
        console.log("PWA was installed");
        deferredPrompt = null;
        dismissInstall();
      });
    </script>
  </body>
</html>
