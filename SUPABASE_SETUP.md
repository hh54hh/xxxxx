# إعداد سوبربيس لنظام إدارة صالة حسام جم

## الخطوات المطلوبة

### 1. إنشاء الجداول في سوبربيس

قم بتسجيل الدخول إلى لوحة تحكم سوبربيس الخاصة بك وانتقل إلى SQL Editor، ثم قم بتشغيل محتوى ملف `supabase_schema.sql` لإنشاء جميع الجداول المطلوبة.

### 2. التحقق من إعدادات الأمان (RLS)

تأكد من أن Row Level Security (RLS) مفعل وأن السياسات مناسبة لاحتياجاتك:

```sql
-- عرض الجداول
SELECT table_name FROM information_schema.tables
WHERE table_schema = 'public';

-- التحقق من تفعيل RLS
SELECT schemaname, tablename, rowsecurity
FROM pg_tables
WHERE schemaname = 'public';
```

### 3. إعداد البيانات الأولية

الملف `supabase_schema.sql` يحتوي على بيانات أولية لـ:

- نقاط التدريب الأساسية (course_points)
- عناصر النظام الغذائي (diet_items)
- منتجات المتجر (products)

### 4. التحقق من الاتصال

بعد تشغيل السكريبت، يمكنك التحقق من الاتصال عبر:

```sql
-- عد السجلات في كل جدول
SELECT
  'subscribers' as table_name, COUNT(*) as count FROM subscribers
UNION ALL
SELECT
  'course_points' as table_name, COUNT(*) as count FROM course_points
UNION ALL
SELECT
  'diet_items' as table_name, COUNT(*) as count FROM diet_items
UNION ALL
SELECT
  'products' as table_name, COUNT(*) as count FROM products;
```

## المميزات المتوفرة الآن

### ✅ المزامنة التلقائية

- تتم المزامنة تلقائياً كل 5 دقائق عند توفر الاتصال
- مزامنة فورية عند العودة للاتصال بالإنترنت
- إشعارات واضحة لحالة الحفظ ("تم الحفظ مع سوبربيس" أو "تم الحفظ مؤقتاً")

### ✅ العمل بدون اتصال

- جميع البيانات محفوظة محلياً باستخدام IndexedDB
- يمكن إضافة وتعديل البيانات بدون اتصال
- قائمة انتظار للمزامنة تعمل عند عودة الاتصال

### ✅ إحصائيات مفصلة

- في صفحة الإعدادات > المزامنة مع سوبربيس
- عدد السجلات المحلية مقابل سوبربيس لكل جدول
- نسبة المزامنة والعناصر في انتظار المزامنة

### ✅ مزامنة ثنائية الاتجاه

- رفع البيانات المحلية إلى سوبربيس
- تحديث البيانات المحلية من سوبربيس
- حل تضارب البيانات (آخر تحديث يفوز)

## كيفية استخدام النظام

### إضافة مشترك جديد

1. انتقل إلى "إضافة مشترك"
2. أدخل المعلومات الأساسية واحفظها
3. أضف مجموعات التدريب والنظام الغذائي
4. احفظ المشترك النهائي
5. ستظهر رسالة "تم الحفظ مع سوبربيس" أو "تم الحفظ مؤقتاً"

### إدارة الكورسات والنظام الغذائي

- جميع العمليات (إضافة، تعديل، حذف) تتزامن مع سوبربيس
- البيانات محفوظة محلياً للعمل بدون اتصال
- تحديث تلقائي عند عودة الاتصال

### مراقبة المزامنة

- انتقل إلى الإعدادات > المزامنة مع سوبربيس
- شاهد الإحصائيات المفصلة لكل جدول
- استخدم "مزامنة كاملة" لإجراء مزامنة فورية

## استكشاف الأخطاء

### مشكلة في الاتصال بسوبربيس

1. تأكد من صحة URL وAPI Key في `src/lib/supabase.ts`
2. تحقق من إعدادات CORS في سوبربيس
3. تأكد من صحة سياسات RLS

### البيانات لا تظهر

1. تحقق من وحدة تحكم المطور للأخطاء
2. تأكد من تشغيل schema SQL بنجاح
3. تحقق من حالة المزامنة في الإعدادات

### مشاكل في الأداء

1. تأكد من وجود الفهارس (indexes) المطلوبة
2. راقب عدد العمليات في قائمة انتظار المزامنة
3. استخدم "مزامنة كاملة" عند الحاجة

## الدعم الفني

- تحقق من ملف `src/lib/syncService.ts` لتفاصيل المزامنة
- استخدم وحدة تحكم المطور لمراقبة العمليات
- جميع الأخطاء مسجلة في console.log

---

**ملاحظة:** النظام مصمم للعمل بشكل مستقل تماماً عن الاتصال، مع مزامنة شاملة عند توفر الاتصال بالإنترنت.
